# kakeibo-app

Google Apps Script (GAS) を利用した、サーバーレスの家計簿アプリケーションです。
クレジットカードや銀行の取引明細CSVをGoogle Drive経由でインポートし、GoogleスプレッドシートをUIおよびデータベースとして使用して、家計の収支管理と可視化を行います。

## 主な機能

-   **柔軟なCSVインポート**: 複数のクレジットカード会社や銀行のフォーマット（支出・収入が別々の列にある形式にも対応）を定義し、手動・自動でのインポートが可能です。
-   **費目の自動分類**: `Settings`シートで定義したキーワードに基づき、取引内容を自動でカテゴリ分けします。
-   **月次レポート**: 指定した月の収入・支出の合計や、カテゴリ別の支出一覧を自動で生成します。
-   **正確な資産推移の可視化**: 銀行の取引明細に含まれる「残高」列のデータを元に、日々の正確な総資産の推移をグラフで確認できます。
-   **割り勘計算**: 「割り勘」「立替」などのキーワードが含まれる支出を抽出し、合計額と明細をレポート化します。

---

## セットアップ方法

### 1. Googleスプレッドシートの準備

1.  このアプリケーションの母体となる、新しいGoogleスプレッドシートを1つ作成します。

### 2. ローカル開発環境のセットアップ

本プロジェクトをローカルにクローンした後、以下の手順でセットアップを行います。

```bash
# 1. clasp（GASのCLIツール）をインストール
npm install -g @google/clasp

# 2. Googleアカウントにログイン（ブラウザが開きます）
clasp login

# 3. プロジェクトとスプレッドシートを紐付け
# まず、スプレッドシートの「拡張機能 > Apps Script」を開き、新しいスクリプトエディタのタブを開きます。
# そのページのURLから SCRIPT_ID をコピーします。
# 例: https://script.google.com/d/SCRIPT_ID/edit

# ローカルの .clasp.json ファイルを以下の内容で手動で作成または編集します。
# rootDir は clasp pull/push の起点となるディレクトリです。
# { "scriptId": "YOUR_SCRIPT_ID", "rootDir": "src" }

# 最後に、リモートのプロジェクトをローカルにダウンロードします。
clasp pull
```

### 3. アプリケーションの初期設定

1.  スプレッドシートを開き、メニューに表示される「家計簿アプリ」>「初期設定」を実行します。
2.  以下のシートが自動で作成されます。
    -   `DB_Transactions`: 全ての取引履歴が保存されるデータベース
    -   `Settings`: カテゴリ分類や割り勘のキーワードを定義する設定シート
    -   `Settings_CsvFormats`: インポートするCSVのフォーマットを定義する設定シート
    -   `Report_MonthlySummary`: 月次レポートの出力先
    -   `Report_TransactionList`: 月次取引明細の出力先
    -   `Report_AssetTransition`: 資産推移グラフの出力先
    -   `Report_Splitwise`: 割り勘計算結果の出力先

---

## 使い方

### 1. 各種設定

インポートを行う前に、自動生成された設定シートに必要な情報を入力します。

-   **`Settings_CsvFormats`シート**
    -   インポートしたいCSVのフォーマットを定義します。`FormatName`には、後述するGoogle Driveのフォルダ名と一致する名前をつけます。
    -   日付、内容、支出額、収入額、残高がそれぞれ何列目にあるかなどを指定します。残高情報がないクレジットカードなどでは、「残高列」は空欄のままで構いません。
-   **`Settings`シート**
    -   取引内容に含まれるキーワードと、それに対応するカテゴリ（食費、固定費など）を定義します。

### 2. 手動インポート

1.  「家計簿アプリ」メニュー > 「CSVファイルを手動インポート」を選択します。
2.  ダイアログで、インポートするCSVのフォーマットを選択し、ファイルを選択します。
3.  インポートが完了すると、`DB_Transactions`シートにデータが追加されます。

### 3. 自動インポート

1.  Google Driveに、CSVファイルをアップロードするためのルートフォルダ（例: `csv-import`）を作成し、その**フォルダID**を控えます。
2.  その中に、`Settings_CsvFormats`の`FormatName`と**同じ名前**のサブフォルダを金融機関ごとに作成します。（例: `csv-import/三井住友カード`, `csv-import/SBI新生銀行`）
3.  Apps Scriptエディタを開き、`Triggers/Trigger_CsvImport.gs` ファイル内の`YOUR_GOOGLE_DRIVE_ROOT_FOLDER_ID`を、控えた**ルートフォルダのID**に書き換えて保存します。
4.  エディタの「トリガー」メニューから、`checkDriveFolderForNewFiles`関数を**時間主導型**（例: 10分おき）で実行するよう設定します。
5.  以降、各金融機関のフォルダにCSVファイルをアップロードすると、自動でインポートが実行され、処理済みのファイルは各フォルダ内の`imported`サブフォルダに移動します。

### 4. レポート機能

-   「家計簿アプリ」メニューから、以下のレポートをいつでも生成できます。
    -   **月次レポートを生成**: 指定した月の収支サマリーと取引明細を作成します。
    -   **資産推移グラフを生成**: `DB_Transactions`に記録された残高情報を元に、日々の総資産の推移をグラフで可視化します。
    -   **割り勘計算**: 指定した月の割り勘対象の支出を合計し、明細を出力します。
