# kakeibo-app

Google Apps Script (GAS) を利用した、サーバーレスの家計簿アプリケーションです。
クレジットカードや銀行の取引明細CSVをGoogle Drive経由でインポートし、GoogleスプレッドシートをUIおよびデータベースとして使用して、家計の収支管理と可視化を行います。

## 主な機能

-   **柔軟なCSVインポート**: 複数のクレジットカード会社や銀行のフォーマットに対応。手動・自動でのインポートが可能です。
-   **費目の自動分類**: `Settings`シートで定義したキーワードに基づき、取引内容を自動でカテゴリ分けします。
-   **月次レポート**: 指定した月の収入・支出の合計や、カテゴリ別の支出一覧を自動で生成します。
-   **資産推移の可視化**: `Accounts`シートに登録した初期残高を元に、日々の収支を反映した総資産の推移をグラフで確認できます。
-   **割り勘計算**: 「割り勘」「立替」などのキーワードが含まれる支出を抽出し、合計額と明細をレポート化します。

---

## セットアップ方法

### 1. Googleスプレッドシートの準備

1.  このアプリケーションの母体となる、新しいGoogleスプレッドシートを1つ作成します。
2.  作成したスプレッドシートのURLから、`SPREADSHEET_ID` を控えておきます。
    -   例: `https://docs.google.com/spreadsheets/d/SPREADSHEET_ID/edit`

### 2. ローカル開発環境のセットアップ

本プロジェクトをローカルにクローンした後、以下の手順でセットアップを行います。

```bash
# 1. clasp（GASのCLIツール）をインストール
npm install -g @google/clasp

# 2. Googleアカウントにログイン（ブラウザが開きます）
clasp login

# 3. プロジェクトとスプレッドシートを紐付け
# SCRIPT_IDは、スプレッドシートの「拡張機能 > Apps Script」を開いた際のURLから取得
clasp clone SCRIPT_ID
```

### 3. アプリケーションの初期設定

1.  スプレッドシートを開き、メニューに表示される「家計簿アプリ」>「初期設定」を実行します。
2.  以下のシートが自動で作成されます。
    -   `DB_Transactions`: 全ての取引履歴が保存されるデータベース
    -   `Settings`: カテゴリ分類や割り勘のキーワードを定義する設定シート
    -   `Settings_CsvFormats`: インポートするCSVのフォーマットを定義する設定シート
    -   `Accounts`: 口座情報と初期残高を管理するシート
    -   `Report_MonthlySummary`: 月次レポートの出力先
    -   `Report_TransactionList`: 月次取引明細の出力先
    -   `Report_AssetTransition`: 資産推移グラフの出力先
    -   `Report_Splitwise`: 割り勘計算結果の出力先

---

## 使い方

### 1. 各種設定

インポートを行う前に、自動生成された設定シートに必要な情報を入力します。

-   **`Accounts`シート**
    -   お持ちの銀行口座や現金の名称、基準日時点での初期残高を入力します。
-   **`Settings_CsvFormats`シート**
    -   インポートしたいCSVのフォーマットを定義します。日付、内容、支出額、収入額がそれぞれ何列目にあるかなどを指定します。
-   **`Settings`シート**
    -   取引内容に含まれるキーワードと、それに対応するカテゴリ（食費、固定費など）を定義します。

### 2. 手動インポート

1.  「家計簿アプリ」メニュー > 「CSVファイルを手動インポート」を選択します。
2.  ダイアログで、インポートするCSVのフォーマットを選択し、ファイルを選択します。
3.  インポートが完了すると、`DB_Transactions`シートにデータが追加されます。

### 3. 自動インポート

1.  Google Driveに、CSVファイルをアップロードするための専用フォルダを作成し、その**フォルダID**を控えます。
2.  Apps Scriptエディタを開き、`Triggers/Trigger_CsvImport.gs` ファイル内の`YOUR_GOOGLE_DRIVE_FOLDER_ID`を、控えたフォルダIDに書き換えて保存します。
3.  エディタの「トリガー」メニューから、`checkDriveFolderForNewFiles`関数を**時間主導型**（例: 10分おき）で実行するよう設定します。
4.  以降、専用フォルダに**ファイル名にフォーマット名（例: `三井住友カード`）を含むCSVファイル**をアップロードすると、自動でインポートが実行されます。

### 4. レポート機能

-   「家計簿アプリ」メニューから、以下のレポートをいつでも生成できます。
    -   **月次レポートを生成**: 指定した月の収支サマリーと取引明細を作成します。
    -   **資産推移グラフを生成**: 全期間の資産の推移をグラフで可視化します。
    -   **割り勘計算**: 指定した月の割り勘対象の支出を合計し、明細を出力します。